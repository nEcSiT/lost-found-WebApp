{% extends 'base.html' %}
{% block title %}Set New Password - Campus Lost & Found{% endblock %}
{% block extra_css %}
<style>
  .main-content { background: transparent !important; }
  .auth-container { display:flex; align-items:center; justify-content:center; min-height: calc(100vh - 140px); }
  .card { background:#fff; border-radius:20px; padding:2rem; width:100%; max-width:520px; box-shadow:0 12px 36px rgba(0,0,0,0.12); }
  .form-group{ margin-bottom:1rem; position:relative; }
  .form-label{ display:block; font-weight:600; margin-bottom:.5rem; }
  .form-input{ width:100%; padding:.9rem 1rem; border:2px solid #e5e7eb; border-radius:12px; }
  .btn{ width:100%; background:#2196f3; color:#fff; border:none; padding:.9rem 1rem; border-radius:12px; font-weight:700; cursor:pointer; }
  .password-wrapper{ position:relative; }
  .toggle-password{ position:absolute; right:12px; top:50%; transform:translateY(-50%); background:none; border:none; cursor:pointer; color:#64748b; padding:4px; border-radius:6px; }
  .toggle-password:hover{ color:#2196f3; background: rgba(33,150,243,0.06); }
</style>
{% endblock %}
{% block content %}
<div class="auth-container">
  <div class="card">
    <h1>Set a new password</h1>
    <p>Enter and confirm your new password for phone {{ phone }}.</p>

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <div class="flash-message info" style="margin:1rem 0;">{{ messages[-1] }}</div>
      {% endif %}
    {% endwith %}

    <form method="post">
      <input type="hidden" name="phone" value="{{ phone }}" />
      <div class="form-group">
        <label class="form-label" for="password">New Password</label>
        <div class="password-wrapper">
          <input class="form-input" id="password" name="password" type="password" minlength="6" required />
          <button type="button" class="toggle-password" data-target="password" aria-label="Show password"><i class="fas fa-eye"></i></button>
        </div>
      </div>
      <div class="form-group">
        <label class="form-label" for="confirm_password">Confirm New Password</label>
        <div class="password-wrapper">
          <input class="form-input" id="confirm_password" name="confirm_password" type="password" minlength="6" required />
          <button type="button" class="toggle-password" data-target="confirm_password" aria-label="Show confirm password"><i class="fas fa-eye"></i></button>
        </div>
      </div>
      <button class="btn" type="submit">Update Password</button>
    </form>
  </div>
</div>
{% endblock %}
{% block extra_js %}
document.addEventListener('DOMContentLoaded', function(){
  document.querySelectorAll('.toggle-password').forEach(function(btn){
    btn.addEventListener('click', function(){
      const id = this.getAttribute('data-target');
      const input = document.getElementById(id);
      if (!input) return;
      const isPass = input.type === 'password';
      input.type = isPass ? 'text' : 'password';
      const icon = this.querySelector('i');
      if (icon) { icon.classList.toggle('fa-eye'); icon.classList.toggle('fa-eye-slash'); }
      this.setAttribute('aria-label', isPass ? 'Hide password' : 'Show password');
    });
  });
  const pwd = document.getElementById('password');
  const conf = document.getElementById('confirm_password');
  const form = document.querySelector('form');
  function validate(){
    if (conf.value && pwd.value !== conf.value) { conf.setCustomValidity('Passwords do not match'); }
    else { conf.setCustomValidity(''); }
  }
  pwd.addEventListener('input', validate);
  conf.addEventListener('input', validate);
  form.addEventListener('submit', function(e){
    validate();
    if (!form.checkValidity()) { e.preventDefault(); form.reportValidity(); }
  });
});
{% endblock %}
